<!DOCTYPE html>
<html lang="en">
<head>
  <title>{{ page.title }}</title>
  <meta charset="UTF-8">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css"/>
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons"/>
  <link rel="stylesheet" href="css/syntax.css">
  <link rel="stylesheet" href="css/fallrisk.github.io.css">
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/zepto/1.2.0/zepto.min.js"></script>
  <script src="https://d3js.org/d3.v4.min.js"></script>
  <script src="js/algorithm_animation.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-45547816-1', 'auto');
    ga('send', 'pageview');
  </script>
</head>
<body>

<div id="banner">
  <div title="Merge Sort Animation">
    <svg id="merge-sort-anim"></svg>
  </div>
  <div id="website-title"><span id="def-stmt">#define</span> __Justin Watson's Website__</div>
  <div id="about"><p>This is my website. There are many like it, but this one is mine.</p></div>
</div>

<div>
  <div id="nav">
    <a title="Justin Watson's Articles" href="{{ site.github.url }}">Articles</a>
  </div>
</div>

<div id="content">
<div class="post" id="post">
<h1 id="angularjs-with-google-geocode-validation">AngularJS with Google Geocode Validation</h1>
<p>In this article I will explain how I created a location validation directive. This
article is an example of how to use promises in directives.
The directive is written in Javascript for AngularJS. The directive is applied
to a form input. The directive uses an AngularJS service to communicate with
Geocode in Google Maps API. The service responds to the directive with a promise.</p>

<h2 id="create-the-example-form">Create the Example Form</h2>
<p>A simple form is made to test the validation and service. This form has only one
input and a submit box. The input will have its value validated to be a real
location. The submit box is disabled until the form is valid.</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;div&gt;</span>
<span class="nt">&lt;form</span> <span class="na">novalidate</span> <span class="na">name=</span><span class="s">"newForm"</span> <span class="na">class=</span><span class="s">"app-form css-form"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"fLocation"</span> <span class="na">class=</span><span class="s">"form-control"</span> <span class="na">ng-model=</span><span class="s">"formData.location"</span>
    <span class="na">placeholder=</span><span class="s">"Location"</span> <span class="na">ng-pattern=</span><span class="s">"/^[a-zA-Z, ]*$/"</span> <span class="na">valid-Location</span> <span class="na">required</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">"form-control btn btn-success"</span> <span class="na">ng-disabled=</span><span class="s">"newForm.$invalid"</span>
    <span class="na">ng-click=</span><span class="s">"doSomething(formData)"</span><span class="nt">&gt;</span>Submit<span class="nt">&lt;/button&gt;</span>
  <span class="nt">&lt;/form&gt;</span>
<span class="nt">&lt;/div&gt;</span></code></pre></figure>

<h2 id="creating-an-angularjs-validation-directive">Creating an AngularJS Validation Directive</h2>
<p>Now lets create the validation directive. When I started this task I followed the
custom validation example at the AngularJS website. The function <code class="highlighter-rouge">numberOfLocations</code>
in the geocode service returns a promise. In order to understand <code class="highlighter-rouge">promises</code> I read
the article <a href="http://andyshora.com/promises-angularjs-explained-as-cartoon.html">“Promises Explained as a Cartoon.”</a>
To act on a promise you add code to a function called by <code class="highlighter-rouge">then</code>.</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">.</span><span class="nx">directive</span><span class="p">(</span><span class="s1">'validLocation'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'GeoCode'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">geoCode</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">{</span>
    <span class="na">require</span><span class="p">:</span> <span class="s1">'ngModel'</span><span class="p">,</span>
    <span class="na">link</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">scope</span><span class="p">,</span> <span class="nx">elm</span><span class="p">,</span> <span class="nx">attrs</span><span class="p">,</span> <span class="nx">ctrl</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">ctrl</span><span class="p">.</span><span class="nx">$parsers</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">viewValue</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">viewValue</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">ctrl</span><span class="p">.</span><span class="nx">$setValidity</span><span class="p">(</span><span class="s1">'validLocation'</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
          <span class="k">return</span> <span class="kc">undefined</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nx">geoCode</span><span class="p">.</span><span class="nx">numberOfLocations</span><span class="p">(</span><span class="nx">viewValue</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'results'</span><span class="p">,</span> <span class="nx">results</span><span class="p">);</span>
          <span class="k">if</span> <span class="p">(</span><span class="mi">1</span> <span class="o">==</span> <span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">ctrl</span><span class="p">.</span><span class="nx">$setValidity</span><span class="p">(</span><span class="s1">'validLocation'</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
            <span class="k">return</span> <span class="nx">viewValue</span><span class="p">;</span>
          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">ctrl</span><span class="p">.</span><span class="nx">$setValidity</span><span class="p">(</span><span class="s1">'validLocation'</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
            <span class="k">return</span> <span class="kc">undefined</span><span class="p">;</span>
          <span class="p">}</span>
        <span class="p">});</span>
      <span class="p">});</span>
    <span class="p">}</span>
  <span class="p">};</span>
<span class="p">}]);</span></code></pre></figure>

<p>Make sure that if you use camel case to define your directive you don’t use camel
case in your HTML form. As you can see above I have “valid-location”, while my
directive is “validLocation.” Note they use “unshift” on the $parsers, while I use
“push.” This is to just add it to the list of parsers and leave it up to your ordering
in the HTML to dictate priority. “Unshift,” would always put it at the top.</p>

<h2 id="creating-the-geocode-angularjs-service">Creating the Geocode AngularJS Service</h2>
<p>In this part we will be creating an adapter for the Google Geocode service that
returns a promise. Geocoding is the process of looking up latitude and longitude
from a string. The Google Geocoding API requires a general location to begin its
search. In this example the variable <code class="highlighter-rouge">myLatLng</code> is that location. To create a promise
follow this easy pattern:</p>

<ol>
  <li>Create the deferred.</li>
  <li>Call the asynchronous function/long running function. It MUST return deferred.resole and/or deferred.reject.</li>
  <li>Return the deferred promise.</li>
</ol>

<p>You can see this pattern being followed in this service.</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">.</span><span class="nx">factory</span><span class="p">(</span><span class="s1">'GeoCode'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$q</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">{</span>
    <span class="na">numberOfLocations</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">address</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">geocoder</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">google</span><span class="p">.</span><span class="nx">maps</span><span class="p">.</span><span class="nx">Geocoder</span><span class="p">();</span>
      <span class="kd">var</span> <span class="nx">deferred</span> <span class="o">=</span> <span class="nx">$q</span><span class="p">.</span><span class="nx">defer</span><span class="p">();</span>
      <span class="kd">var</span> <span class="nx">myLatLng</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">google</span><span class="p">.</span><span class="nx">maps</span><span class="p">.</span><span class="nx">LatLng</span><span class="p">(</span><span class="mf">36.05</span><span class="p">,</span> <span class="o">-</span><span class="mf">118.25</span><span class="p">);</span>
      <span class="nx">geocoder</span><span class="p">.</span><span class="nx">geocode</span><span class="p">(</span> <span class="p">{</span><span class="s1">'address'</span><span class="p">:</span> <span class="nx">address</span><span class="p">,</span> <span class="na">latLng</span><span class="p">:</span> <span class="nx">myLatLng</span> <span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">results</span><span class="p">,</span> <span class="nx">status</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">status</span> <span class="o">==</span> <span class="nx">google</span><span class="p">.</span><span class="nx">maps</span><span class="p">.</span><span class="nx">GeocoderStatus</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">deferred</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">results</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">deferred</span><span class="p">.</span><span class="nx">reject</span><span class="p">();</span>
      <span class="p">});</span>
      <span class="k">return</span> <span class="nx">deferred</span><span class="p">.</span><span class="nx">promise</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">};</span>
<span class="p">});</span></code></pre></figure>


</div>

</div> <!-- /contianer -->

<div id="footer">
  <p class="text-center">
    <a href="https://github.com/fallrisk" role="button" class="">
      <i class="fa fa-github fa-padded"></i>
      <span> Github</span>
    </a>
    <a href="https://www.linkedin.com/profile/view?id=AAMAAA-Hfg4BQSzKwQrZBimtS3uKCWgPvSdxHEg&amp;trk=hp-identity-name" role="button" class="">
      <i class="fa fa-linkedin-square fa-padded"></i>
      <span> LinkedIn</span>
    </a>
    <a href="http://www.freecodecamp.com/fallrisk" role="button" class="">
      <i class="fa fa-fire fa-padded"></i>
      <span> FreeCodeCamp</span>
    </a>
    <a href="http://codepen.io/fallrisk/" role="button" class="">
      <i class="fa fa-codepen fa-padded"></i>
      <span> Codepen.io</span>
    </a>
  </p>
</div>
</body>
</html>